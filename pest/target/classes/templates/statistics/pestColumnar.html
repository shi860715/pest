<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
	<head>
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<meta name="keywords" content="生兴防治" />
		<meta name="description" content="生兴防治" />
		<title>生兴防治</title>
		<!-- basic styles -->
		<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
		<link th:href="@{/css/font-awesome.min.css}" rel="stylesheet" />

		<!--[if IE 7]>
		  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!-- page specific plugin styles -->

		<!-- fonts -->

		<!-- ace styles -->

		<link rel="stylesheet" th:href="@{/css/ace.min.css}"/>
		<link rel="stylesheet" th:href="@{/css/ace-rtl.min.css}"/>
		<link rel="stylesheet" th:href="@{/css/ace-skins.min.css}"/>
		<link rel="stylesheet" th:href="@{/css/newCss.css}"/>
		<link rel="stylesheet" th:href="@{/css/bootstrap-datetimepicker.css}"/>
		<style type="text/css">
			.table-condensed{
				width:230px;
			}
		</style>
		
		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- inline styles related to this page -->

		<!-- ace settings handler -->

		<script type="text/javascript" th:src="@{/js/ace-extra.min.js}"></script>

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

		<!--[if lt IE 9]>
		<script src="assets/js/html5shiv.js"></script>
		<script src="assets/js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body>
		<div th:include="common/top :: top"></div>

		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<div class="main-container-inner">
				<a class="menu-toggler" id="menu-toggler" href="#">
					<span class="menu-text"></span>
				</a>

				<div class="sidebar" id="sidebar" th:include="common/leftMenu :: leftMenu"></div>

				<div class="main-content">
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>

						<ul class="breadcrumb">
							<li>
								<i class="icon-home home-icon"></i>
								<a href="#">首页</a>
							</li>
							<li class="active">统计分析</li>
							<li class="active">虫害柱状图</li>
						</ul><!-- .breadcrumb -->
					</div>

					<div class="page-content statistical_con">
						<div class="row">
							<div class="col-sm-12">
								<div class="widget-box">
									<div class="widget-header widget-header-flat widget-header-small">
										<h4 class="lighter">
											<i class="icon-bar-chart"></i>
											虫害柱状图
										</h4>
                                        <dl style="margin-right: 50px;">
                                        	<dd><label>请选择展示类型：</label><select id="type"><option value="1">月比较</option><option value="2">年比较</option></select></dd>
                                        	<dd id="month"><label>展示月份：</label><input id="monthTime" type="text" readonly="readonly"></dd>
                                        	<dd style="display: none;" id="year"><label>展示年份：</label><input id="yearTime" type="text" readonly="readonly"></dd>
                                        	<dd><label>请选择需要比较的虫类：</label><select id="insectId1"><option value="">--请选择--</option></select>与<select id="insectId2"><option value="">--请选择--</option></select></dd>
                                        	<dd><button class="btn btn-primary" style="border-width: 0;padding: 4px 10px;" onclick="doSearch()">统计</button></dd>
                                        </dl>
									</div>

									<div class="widget-body">
										<div class="widget-main" style="padding: 50px 60px;">
											<div id="pestHistogram" style="width: 100%; height: 300px;"></div>
										</div><!-- /widget-main -->
									</div><!-- /widget-body -->
								</div><!-- /widget-box -->
							</div><!-- /span -->
						</div><!-- /row -->
						<div th:include="common/footer :: footer"></div>
					</div><!-- /.page-content -->
				</div><!-- /.main-content -->
				<div th:include="common/toolbar :: toolbar"></div>
			</div><!-- /.main-container-inner -->

			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="icon-double-angle-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->

		<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>

		<!-- <![endif]-->

		<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

		<!--[if !IE]> -->

		<script type="text/javascript">
		window.jQuery || document.write("<script type='text/javascript' th:src='@{/js/jquery-2.0.3.min.js}'>"+"<"+"/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"script>");
</script>
<![endif]-->

		<script type="text/javascript">
		if("ontouchend" in document) document.write("<script type='text/javascript' th:src='@{/js/jquery.mobile.custom.min.js}'>"+"<"+"/script>");
		</script>
		<script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/typeahead-bs2.min.js}"></script>

		<!-- page specific plugin scripts -->
        <script type="text/javascript" th:src="@{/js/echart/echarts.min.js}"></script>
		<!--[if lte IE 8]>
		  <script src="assets/js/excanvas.min.js"></script>
		<![endif]-->

		<script type="text/javascript" th:src="@{/js/jquery-ui-1.10.3.custom.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/jquery.ui.touch-punch.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/jquery.slimscroll.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/jquery.easy-pie-chart.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/jquery.sparkline.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/flot/jquery.flot.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/flot/jquery.flot.pie.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/flot/jquery.flot.resize.min.js}"></script>

		<!-- ace scripts -->

		<script type="text/javascript" th:src="@{/js/ace-elements.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/ace.min.js}"></script>
		<script type="text/javascript" th:src="@{/js/layui/layui.js}"></script>

		<!-- inline scripts related to this page -->
        <script type="text/javascript" th:src="@{/js/bootstrap-datetimepicker.js}"></script>
        <script type="text/javascript" th:src="@{/js/bootstrap-datetimepicker.zh-CN.js}"></script>
		<script type="text/javascript">
			var layer;
			layui.use('layer', function(){
			  	layer = layui.layer;
			  	
			});
			$('#monthTime').datetimepicker({
				format: 'yyyy-mm',  
		         autoclose: true,  
		         startView: 3,  
		         minView: 3,  
		         forceParse: false,  
		         language: 'zh-CN'
		    });
			$('#yearTime').datetimepicker({  
		        format: 'yyyy',  
		         weekStart: 1,  
		         autoclose: true,  
		         startView: 4,  
		         minView: 4,  
		         forceParse: false,  
		         language: 'zh-CN'  
		    }); 
			
			$("#type").change(function(){
				if($(this).val() == 1){
					$('#month').show();
					$('#year').hide();
					$('#yearTime').val('');
				}else{
					$('#month').hide();
					$('#year').show();
					$('#monthTime').val('');
				}
				
			});
			
			$.ajax({
	            cache: true,
	            type: "POST",
	            url:'/insectPage/getAllInsect',
	            async: false,
	            dataType:'json',
	            success: function(obj) {
	            	var insects = obj.data;
	            	var appendStr = '';
	            	for(var i=0;i<insects.length;i++){
                    	appendStr += "<option value='"+insects[i].id+"'>"+insects[i].name+"</option>"
                    }
	            	$("#insectId1").append(appendStr);
	            	$("#insectId2").append(appendStr);
	            }
	        });
			/*柱状图*/
		    var myChart = echarts.init(document.getElementById('pestHistogram'));
		    var optionHistogram = {
				    tooltip : {
				        trigger: 'axis',
				        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
				            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
				        }
				    },
				    grid: {
				        left: '3%',
				        right: '4%',
				        bottom: '3%',
				        containLabel: true
				    },
				    xAxis : [
				        {
				            type : 'category',
				            data : [],
				            axisTick: {
				                alignWithLabel: true
				            }
				        }
				    ],
				    yAxis : [
				        {
				            type : 'value'
				        }
				    ],
				    series : []
				};
	      	// 使用刚指定的配置项和数据显示图表。
	        //myChart.setOption(optionHistogram);
	      	
	      	
	      	function doSearch(){
	      		var insectId1 = $("#insectId1").val();
	      		var insectId2 = $("#insectId2").val();
	      		if(!insectId2 || !insectId1){
	      			layer.msg("请选择需要比较的虫类！");
					return;
	      		}
	      		var series = [{
		            name:$("#insectId1").find("option:selected").text(),
		            type:'bar',
		            barWidth: '25px',
		            itemStyle:{
		            	color:'#f9595b',
		            },
		            data:[]
		        },
		        {
		            name:$("#insectId2").find("option:selected").text(),
		            type:'bar',
		            barWidth: '25px',
		            itemStyle:{
		            	color:'#00aa83',
		            },
		            
		            data:[]
		        }];
	      		var type = $("#type").val();
	      		var captureTime;
				if(type == 1){
					if($("#monthTime").val()){
						captureTime = $("#monthTime").val() + "-01 00:00:00";
						
					}else{
						layer.msg("请输入需要查询的时间！");
						return;
					}
				}else{
					if($("#yearTime").val()){
						captureTime = $("#yearTime").val() + "-01-01 00:00:00";
					}else{
						layer.msg("请输入需要查询的时间！");
						return;
					}
				}
				
				$.ajax({
		            cache: true,
		            type: "POST",
		            url:'/statisticsPage/findPestColumnarPage',
		            async: false,
		            data:{insectId1:insectId1,insectId2:insectId2,type:type,captureTime:captureTime},
		            dataType:'json',
		            success: function(obj) {
		            	var areas = obj.data[0];
		            	var collects = obj.data[1];
		            	var xAxisArray = [];
		            	
		            	for(var i=0;i<areas.length;i++){
		            		series[0].data.push(0);
		            		series[1].data.push(0);
		            		var area = areas[i];
		            		xAxisArray.push(area.name);
		            		for(var j=0;j<collects.length;j++){
		            			var collect = collects[j];
		            			if(collect.insectId == insectId1 && area.name == collect.areaName){
		            				series[0].data[i] = collect.totalCount;
		            			}else if(collect.insectId == insectId2 && area.name == collect.areaName){
		            				series[1].data[i] = collect.totalCount;
		            			}
		            		}
		            	}
		            	
		            	optionHistogram.xAxis[0].data = xAxisArray;
		            	if(insectId1 == insectId2){
		            		series[1].data = series[0].data;
		            	}
		            	if(xAxisArray.length <= 5){
		            		series[0].barWidth = '50px';
		            		series[1].barWidth = '50px';
		            	}
		            	if(xAxisArray.length >= 15){
		            		series[0].barWidth = '12px';
		            		series[1].barWidth = '12px';
		            	}
		            	
		            	optionHistogram.series = series;
		            	myChart.clear();
		            	myChart.setOption(optionHistogram);
		            }
		        });
	      	}
		</script>
	</body>
</html>

